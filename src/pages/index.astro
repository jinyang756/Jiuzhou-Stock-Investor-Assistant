---
import Layout from '../layouts/Layout.astro';
import IndexCard from '../components/market/IndexCard.astro';
import StockPicker from '../components/market/StockPicker.astro';
import CustomerService from '../components/common/CustomerService.astro';
import FloatingButton from '../components/common/FloatingButton.astro';
import ComplaintEntry from '../components/common/ComplaintEntry.astro';

// 加载市场数据（处理可能的加载失败）
let marketData;
try {
  marketData = await import('../../public/data/sina-market-data.json');
  // 确保数据结构完整
  if (!marketData.sh || !marketData.north) {
    throw new Error('数据结构不完整');
  }
} catch (error) {
  console.warn('数据加载失败，使用默认数据:', error instanceof Error ? error.message : String(error));
  // 提供默认数据，避免页面空白
  marketData = {
    sh: { index: 3285.67, change: 26.83 },
    north: { netInflow: 52.3, rate: '3.2%' },
    limitUp: 48,
    updateTime: new Date().toLocaleTimeString()
  };
}
---

<Layout title="九州股民助手 - 首页">
  <!-- 顶部悬浮转化按钮 -->
  <FloatingButton />

  <!-- 页面标题区 -->
  <section class="mb-10 text-center">
    <h1 class="text-4xl font-bold mb-3 bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent">
      九州股民助手
    </h1>
    <p class="text-gray-300 max-w-2xl mx-auto">
      提供专业的市场数据查询与投资者教育服务，助您把握市场动态
    </p>
    <p class="text-xs text-gray-500 mt-2">
      数据更新时间: {marketData.updateTime}
    </p>
  </section>

  <!-- 核心数据卡片区 -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold mb-6 text-blue-400">今日必看数据</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <IndexCard 
        title="上证指数" 
        value={marketData.sh.index.toFixed(2)} 
        change={`${marketData.sh.change > 0 ? '+' : ''}${marketData.sh.change.toFixed(2)}点 (${(marketData.sh.change / (marketData.sh.index - marketData.sh.change) * 100).toFixed(2)}%)`} 
        isRise={marketData.sh.change > 0} 
      />
      <IndexCard 
        title="北向资金" 
        value={`${marketData.north.netInflow > 0 ? '+' : ''}${marketData.north.netInflow}亿`} 
        change={marketData.north.rate} 
        isRise={marketData.north.netInflow > 0} 
      />
      <IndexCard 
        title="涨停家数" 
        value={`${marketData.limitUp}家`} 
        change="较昨日+5" 
        isRise={true} 
      />
    </div>
  </section>

  <!-- 选股工具区 -->
  <section class="mb-12 bg-white/5 backdrop-blur-sm p-6 rounded-xl">
    <h2 class="text-2xl font-bold mb-6 text-blue-400">爆款选股工具</h2>
    <StockPicker />
  </section>

  <!-- 免费课程区 -->
  <section class="mb-12 bg-white/5 backdrop-blur-sm p-6 rounded-xl">
    <h2 class="text-2xl font-bold mb-6 text-blue-400">3分钟学会看成交量</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
      <div>
        <img 
          src="https://picsum.photos/600/400" 
          alt="成交量分析示例图" 
          class="rounded-lg w-full h-auto"
        />
      </div>
      <div>
        <p class="text-gray-300 mb-4">
          成交量突然放大意味着什么？如何通过成交量判断主力动向？<br><br>
          本课程将通过3个实际案例，教您快速掌握成交量与股价走势的关系，识别买卖信号。
        </p>
        <a href="/education" class="inline-block bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors">
          观看课程 →
        </a>
      </div>
    </div>
  </section>

  <!-- 投资顾问区 -->
  <section class="mb-12">
    <CustomerService />
    <ComplaintEntry />
  </section>

  <!-- 合规声明区 -->
  <section class="text-center text-xs text-gray-500 py-6 border-t border-gray-800">
    <p>⚠️ 风险提示：本平台仅提供投资者教育服务，所有数据仅供参考，不构成任何投资建议</p>
    <p class="mt-2">股市有风险，投资需谨慎 | 九州股民助手 © 2023 版权所有</p>
  </section>
</Layout>
